\section{Construction on the vertex set through groups}

As \propref{prop:equi} is a complete characterization of convolutions, it can be used to define them \ie convolutive operations can be constructed as the set of linear transformations that are equivariant to translations. However, in the general case where $G$ is not a grid graph, translations are not defined, so that construction needs to be generalized beyond translational equivariances.

\todo{reword sentence below (not exactly true)}
A classic result from group theory is that one sense of this characterization (equivariance) hold for groups of (bijective) transformations, where the group of translations is a particular case. More generally, it also holds for groupoids \citep{weinstein1996groupoids}. The converse sense will be discussed later.

Note that our approach is different than in \citep{cohen2016group}, where the authors define group-equivariant convolutions from an already defined convolution. On graphs, convolutions aren't already defined. We are studying group convolutions in view of constructing one.

\begin{definition}\textbf{Group convolution I}\\
Let a group $\group$, the group convolution I between two signals $s_1$ and $s_2 \in \cs(\group)$ is defined as:
\begin{align*}
\forall h \in \group, (s_1 \ast_{\I} s_2)[h] & = \displaystyle \sum_{g \in \group} s_1[g] \h{2} s_2[g^{-1}h]%\\
%& = \displaystyle \sum_{ab = h} s_1[a] \h{2} s_2[b]
\end{align*}
provided one of the signals has finite support if $\group$ is not finite.
\label{def:conv1}
\end{definition}

For a graph $\gve$ and a subgroup $\Gamma \subset \Phi^*(V)$, this definition is applicable for $\cs(\Gamma)$, but not for $\cs(V)$ as $V$ is not a group. Nonetheless, our point here is that we will use the group convolution on $\cs(\Gamma)$ to construct the convolutions on $\cs(V)$.

For now, let's assume $\Gamma$ is in one-to-one correspondence with $V$, and let's define an isomorphism $\varphi$ from $\Gamma$ to $V$, to equip $V$ with a group structure. We denote $\Gamma \overset{\varphi}{\cong} V$ and $g_v \overset{\varphi}\mapsto v$.

Then, the linear morphism $\widetilde\varphi$ from $\cs(\Gamma)$ to $\cs(V)$ defined on the Dirac bases by $\widetilde\varphi(\delta_g) = \delta_{\varphi(g)}$ is also an isomorphism. Hence, $V$ and $\cs(V)$ would inherit the same inherent structural properties as $\Gamma$ and $\cs(\Gamma)$, in addition of being related in the same way. For notational simplicity, we will use the same symbol $\varphi$ for $\varphi$ and $\widetilde\varphi$ (as done between $f$ and $L_f$). A commutative diagram between the sets is depicted on \figref{fig:iso}.

\begin{figure}[H]
\centering
\begin{tikzcd}%
    \Gamma \arrow{r}{\varphi}  \arrow{d}[swap]{\cs}  & V \arrow{d}{\cs}\\  
    \cs(\Gamma) \arrow{r}[swap]{\varphi}  & \cs(V) 
\end{tikzcd}%
\caption{Commutative diagram between sets}
\label{fig:iso}
\end{figure}

\begin{lemma}\textbf{Relation between $\cs(\Gamma)$ and $\cs(V)$}\\
$\forall s \in \cs(\Gamma), \forall u \in V, \varphi(s)[u] = s[\varphi^{-1}(u)] = s[g_u]$
\label{lem:outer}
\end{lemma}
\begin{proof}
\begin{align*}
\forall s \in \cs(\Gamma), \varphi(s) & = \varphi(\displaystyle \sum_{g \in \Gamma} s[g] \h{2} \delta_g)
 = \displaystyle \sum_{g \in \Gamma} s[g] \h{2} \varphi(\delta_g)
 = \displaystyle \sum_{g \in \Gamma} s[g] \h{2} \delta_{\varphi(g)}\\
 & = \displaystyle \sum_{v \in V} s[g_v] \h{2} \delta_v\\
 \text{So }\forall v \in V, \varphi(s) [u] & = s[g_u]
\end{align*}
\end{proof}

Hence, we can steer the definition of the group convolution from $\cs(\Gamma)$ to $\cs(V)$ as follows:

\begin{definition}\textbf{Group convolution II}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$.
The group convolution II between two signals $s_1$ and $s_2 \in \cs(V)$ is defined as:
\begin{align*}
\forall u \in V, (s_1 \ast_{\II} s_2) [u] & = \displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[\varphi(g_v^{-1}g_u)]\\
& = \displaystyle \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_u }} s_1[a] \h{2} s_2[b]
\end{align*}
\label{def:conv2}
\end{definition}

\begin{proposition}\textbf{Relation between group convolution I and II}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$,
\begin{gather*}
\forall s_1, s_2 \in \cs(\Gamma), \forall u \in V,
(\varphi(s_1) \ast_{\II} \varphi(s_2))[u] = (s_1 \ast_{\I} s_2)[g_u]
\end{gather*}
\end{proposition}

\begin{proof}
Using \lemref{lem:outer},
\begin{align*}
(\varphi(s_1) \ast_{\II} \varphi(s_2))[u] & = \displaystyle \sum_{v \in V} \varphi(s_1)[v] \h{2} \varphi(s_2)[\varphi(g_v^{-1}g_u)]\\
 & = \displaystyle \sum_{v \in V} s_1[g_v] \h{2} s_2[g_v^{-1}g_u]\\
 & = \displaystyle \sum_{g \in \Gamma} s_1[g] \h{2} s_2[g^{-1}g_u]\\
 & = (s_1 \ast_{\I} s_2)[g_u]
\end{align*}
\end{proof}

\begin{proposition}\textbf{Equivariance to $\varphi(\Gamma)$}\\
With \defref{def:conv2}, convolution operators acting on the right of $\cs(V)$ are equivariant to $\varphi(\Gamma)$ \ie
\begin{gather*}
\exists w \in \cs(V), f = . \ast_{\II} w \Rightarrow \forall v \in V, f \circ \varphi(g_v) = \varphi(g_v) \circ f
\end{gather*}
\label{prop:equi}
\end{proposition}

\begin{proof}
\begin{align*}
\forall s \in \cs(V), \forall u \in V & ,\forall v \in V,\\
(f_w \circ \varphi(g_u)) (s) [v] & = \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_v }} \varphi(g_u)(s)[a] \h{2} w[b]\\
& = \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_v }} s[\varphi(g_u)^{-1}(a)] \h{2} w[b]\\
& = \sum_{\substack{(a,b) \in V^2 \\ \st g_{\varphi(g_u)(a)}g_b=g_v }} s[a] \h{2} w[b]\\
\end{align*}
Because $\varphi$ is an isomorphism, its inverse $c \mapsto g_c$ is also an isomorphism and so $g_{\varphi(g_u)(a)}g_b=g_v \Leftrightarrow g_{a}g_b=g_{\varphi(g_u)^{-1}(v)}$. So we have:
\begin{align*}
(f_w \circ \varphi(g_u)) (s) [v] & = \sum_{\substack{(a,b) \in V^2 \\ \st g_{a}g_b=g_{\varphi(g_u)^{-1}(v)} }} s[a] \h{2} w[b]\\
& = s \ast_{\II} w [\varphi(g_u)^{-1}(v)]\\
& = (\varphi(g_u) \circ f_w) (s) [v]
\end{align*}
\end{proof}

\begin{remark}Note that convolution operators of the form $f_w = . \ast_{\I} w$ are also equivariant to $\group$, but the proposition and the proof are omitted as they are similar to the latter.
\end{remark}

In fact, both group convolutions are the same as the latter one borrows the algebraic structure of the first one. Thus we only obtain equivariance to $\varphi(\Gamma)$, which is actually $V$ equipped with the group structure of $\Gamma$ mirrored via $\varphi$. To obtain equivariance to $\Gamma$, we need to take into account the fact that it contains bijective transformations of $V$.

Hence, note that $g \in \Gamma$ can act on both $\Gamma$ through the left multiplication and on $V$ as being an object of $\Phi^{*}(V)$. This ambivalence can be seen on a commutative diagram, see \figref{fig:com}.%, where all arrows except the one labeled with \eqref{eq:P} are always true.

\begin{figure}[H]
\centering
\begin{tikzcd}
    g_u \arrow{r}{g_v}  \arrow{d}[swap]{\varphi}  & g_vg_u \arrow{d}{\varphi}\\  
    u \arrow{r}{\eqref{eq:P}}[swap]{g_v}  & \varphi(g_vg_u)
\end{tikzcd}
\caption{Commutative diagram. All arrows except for the one labeled with \eqref{eq:P} are always True.}
\label{fig:com}
\end{figure}

For \eqref{eq:P} to be true means that $\varphi$ is an equivariant map between groups \ie whether the mapping is done before or after the action of $\Gamma$ has no impact on the result. When such $\varphi$ exists, $\Gamma$ and $V$ are said to be equivalent (in the isomorphic sense) and we denote $\Gamma \equiv V$.

\begin{definition}\textbf{Equivariant map}\\
An isomorphism $\varphi$ between a group of permutations $\cg$ and a group $\ch$ is said to be an \emph{equivariant map} if
\begin{gather*}
\forall g, h \in \cg, g(\varphi(h)) = \varphi(gh)
\end{gather*}
\end{definition}

In our case, if $\Gamma \equiv V$, we are interested to know if our~$\varphi$~exhibits the equivalence.

\begin{definition}\textbf{$\varphi$-Equivalence}\\
A subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$, is said to be \emph{$\varphi$-equivalent} if $\varphi$ is an equivariant map \ie if it verifies the property:
\begin{gather*}
\forall v, u \in V, g_v(u) = \varphi(g_vg_u) \tag{P}\label{eq:P}
\end{gather*}
\end{definition}

In that case we denote $\Gamma \overset{\varphi}{\equiv} V$

\begin{remark}
For example, translations on the grid graph, with $\varphi(t_{i,j}) = (i,j)$, are $\varphi$-equivalent as $t_{i,j}(a,b) = \varphi(t_{i,j} \circ t_{a,b})$. However, with $\varphi(t_{i,j}) = (-i,-j)$, they would not be $\varphi$-equivalent.
\end{remark}

\begin{definition}\textbf{Group convolution III}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $V \cong \Gamma$ through an isomorphism $g_v \overset{\varphi}\mapsto v$.
The group convolution III between two signals $s_1$ and $s_2 \in \cs(V)$ is defined as:
\begin{align}
s_1 \ast_{\III} s_2 & = \displaystyle \sum_{v \in V} s_1[v] \h{2} g_v(s_2)\label{eq:vdom}\\
& = \displaystyle \sum_{g \in \Gamma} s_1[\varphi(g)] \h{2} g(s_2) \label{eq:premix}
\end{align}
\label{def:conv3}
\end{definition}

The two expressions differ on the domain upon which the summation is done. The expression \eqref{eq:vdom} put the emphasis on each vertex and its action, whereas the expression \eqref{eq:premix} emphasizes on each object of $\Gamma$.

\begin{lemma}\textbf{Relation with group convolution II}\\
$\Gamma \text{ is } \varphi \text{-equivalent} \Leftrightarrow \ast_{\II} = \ast_{\III}$
\label{lem:rel}
\end{lemma}

\begin{proof}
\begin{align}
\forall s_1, s_2 & \in \cs(V),\nonumber\\
& s_1 \ast_{\II} s_2 = s_1 \ast_{\III} s_2 \nonumber\\
& \Leftrightarrow \forall u \in V,
\displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[\varphi(g_v^{-1}g_u)] = \displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[g_v^{-1}(u)] \label{eq:free}
\end{align}
Hence, the direct sense is obtained by applying \eqref{eq:P}. 

For the converse, given $u, v \in V$, we first realize \eqref{eq:free} for $s_1 := \delta_v$, obtaining $s_2[\varphi(g_v^{-1}g_u)] = s_2[g_v^{-1}(u)]$, which we then realize for a real signal $s_2$ having no two equal entries, obtaining $\varphi(g_v^{-1}g_u) = g_v^{-1}(u)$. From the latter we finally obtain \eqref{eq:P} with the one-to-one correspondence $v := v^{-1}$, where $v^{-1} = \varphi(g_v^{-1})$ and using the fact that $\varphi$ and $\varphi^{-1}$ are isomorphisms.
\end{proof}

This time, we obtain equivariance to $\Gamma$.

\begin{proposition}\textbf{Equivariance to $\Gamma$}\\
If $\Gamma$ is $\varphi$-equivalent, convolution operators acting on the right of $\cs(V)$ are equivariant to $\Gamma$ \ie
\begin{gather*}
\begin{cases}
\Gamma \text{ is } \varphi \text{-equivalent}\\
\exists w \in \cs(V), f = . \ast w
\end{cases}
\Rightarrow \forall g \in \Gamma, f \circ g = g \circ f
\end{gather*}
where $\ast$ denote either $\ast_{\II}$ or $\ast_{\III}$.
\label{prop:equi}
\end{proposition}

\begin{proof}
In the following equations, \eqref{eq:rel} is obtained from \lemref{lem:rel}, \eqref{eq:left} is obtained because left multiplication in a group is an isomorphism, and \eqref{eq:pty} is obtained because of \eqref{eq:P}.
\begin{align}
\forall g \in \Gamma, \forall s \in \cs(V), & \nonumber\\
f_w \circ g (s) & = \displaystyle \sum_{h \in \Gamma} g(s)[\varphi(h)] \h{2} h(w)\label{eq:rel}\\
 & = \displaystyle \sum_{h \in \Gamma} g(s)[\varphi(gh)] \h{2} gh(w)\label{eq:left}\\
 & = \displaystyle \sum_{h \in \Gamma} g(s)[g(\varphi(h))] \h{2} gh(w)\label{eq:pty}\\
 & = \displaystyle \sum_{h \in \Gamma} s[\varphi(h)] \h{2} gh(w)\nonumber\\
\forall g \in \Gamma, \forall s \in \cs(V), & \forall u \in V, \nonumber\\
f_w \circ g (s) [u] & = \displaystyle \sum_{h \in \Gamma} s[\varphi(h)] \h{2} h(w)[g^{-1}(u)]\nonumber\\
& = f_w (s) [g^{-1}(u)]\nonumber\\
& = g \circ f_w (s) [u]\nonumber
\end{align}
\end{proof}

From $\eqref{eq:premix}$, we define a mixed domain convolution \ie that is defined for $r \in \cs(\Gamma)$ and $s \in \cs(V)$, without the need of expliciting the isomorphisms $\varphi$.

\begin{definition}\textbf{Mixed domain convolution}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $V \cong \Gamma$.
The mixed domain convolution between two signals $r \in \cs(\Gamma)$ and $s \in \cs(V)$ results in a signal $r \ast_{\M} s \in \cs(V)$ and is defined as:
\begin{align*}
\forall u \in V, (r \ast_{\M} s) [u] & = \displaystyle \sum_{g \in \Gamma} r[g] \h{2} g(s)
\end{align*}
\label{def:convm}
\end{definition}

\begin{proposition}\textbf{Relation with group convolution III}\\
$\forall \varphi \in \iso(\Gamma, V), r \ast_{\M} s = \varphi(r) \ast_{\II} s$
\end{proposition}

\begin{proof}
\todo{}
\end{proof}

\begin{proposition}\textbf{Relation with group convolution I}\\
Let $\varphi \in \iso(\Gamma, V)$, we have\\
$r \ast_{\M} s = r \ast_{\I} \varphi^{-1}(s) \Leftrightarrow \Gamma \text{ is } \varphi \text{-equivalent}$
\end{proposition}

\begin{proof}
\todo{}
\end{proof}

The direct result is important because it justifies that even without the need of expliciting them, there are underlying isomorphisms $\varphi$ for which the group $\Gamma$ is $\varphi$-equivalent.