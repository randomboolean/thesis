\section{Construction from the vertex set}

\subsection{Introduction}

As \propref{prop:equi} is a complete characterization of convolutions, it can be used to define them \ie convolutive operations can be constructed as the set of linear transformations that are equivariant to translations. However, in the general case where $G$ is not a grid graph, translations are not defined, so that construction needs to be generalized beyond translational equivariances.

In mathematics, convolutions are more generally defined for signals defined over a group structure. The classical convolution that is used in deep learning is just a narrow case where the domain group is an euclidean space. Therefore, constructing a convolution on graphs should start from the more general definition of convolution on groups rather than convolution on euclidean domains.

Our construction is motivated by the following questions:
\begin{itemize}
\item Does the equivariance property holds ? Does the characterization from \propref{prop:equi} still holds ?
\item Is it possible to extend the construction on non-group domains, or at least on mixed domains ? (\ie one signal is defined over a set, and the other is defined over a subgroup of the transformations of this set).
\item Can a group domain draw an underlying graph structure ? Is the group convolution naturally defined on this class of graphs ?
\end{itemize}

% Note that our approach is different than in \citep{cohen2016group}, where the authors define group-equivariant convolutions from an already defined convolution. On graphs, convolutions aren't already defined. We are studying group convolutions in view of constructing one.

We first recall the notion of group and group convolution.

\begin{definition}\textbf{Group}\\
A group $\group$ is a set equipped with an closed and associative composition law that admits a unique left-right identity element and associates an inverse to each object of the set.
\end{definition}

\begin{definition}\textbf{Group convolution I}\\
Let a group $\group$, the group convolution I between two signals $s_1$ and $s_2 \in \cs(\group)$ is defined as:
\begin{align*}
\forall h \in \group, (s_1 \ast_{\I} s_2)[h] & = \displaystyle \sum_{g \in \group} s_1[g] \h{2} s_2[g^{-1}h]%\\
%& = \displaystyle \sum_{ab = h} s_1[a] \h{2} s_2[b]
\end{align*}
provided at least one of the signals has finite support if $\group$ is not finite.
\label{def:conv1}
\end{definition}

\subsection{Steered construction from groups}

For a graph $\gve$ and a subgroup $\Gamma \subset \Phi^*(V)$, \defref{def:conv1} is applicable for $\cs(\Gamma)$, but not for $\cs(V)$ as $V$ is not a group. Nonetheless, our point here is that we will use the group convolution on $\cs(\Gamma)$ to construct the convolutions on $\cs(V)$.

For now, let's assume $\Gamma$ is in one-to-one correspondence with $V$, and let's define an isomorphism $\varphi$ from $\Gamma$ to $V$, to equip $V$ with a group structure. We denote $\Gamma \overset{\varphi}{\cong} V$ and $g_v \overset{\varphi}\mapsto v$.

Then, the linear morphism $\widetilde\varphi$ from $\cs(\Gamma)$ to $\cs(V)$ defined on the Dirac bases by $\widetilde\varphi(\delta_g) = \delta_{\varphi(g)}$ is also an isomorphism. Hence, $V$ and $\cs(V)$ would inherit the same inherent structural properties as $\Gamma$ and $\cs(\Gamma)$, in addition of being related in the same way. For the sake of notational simplicity, we will use the same symbol $\varphi$ for $\varphi$ and $\widetilde\varphi$ (as done between $f$ and $L_f$). A commutative diagram between the sets is depicted on \figref{fig:iso}.

\begin{figure}[H]
\centering
\begin{tikzcd}%
    \Gamma \arrow{r}{\varphi}  \arrow{d}[swap]{\cs}  & V \arrow{d}{\cs}\\  
    \cs(\Gamma) \arrow{r}[swap]{\varphi}  & \cs(V) 
\end{tikzcd}%
\caption{Commutative diagram between sets}
\label{fig:iso}
\end{figure}

Then we naturally obtain the following relation, which put in simpler words means that signals on $\cs(\Gamma)$ are mapped to $\cs(V)$ when $\varphi$ is simultaneously applied on both the signal space and its domain.

\begin{lemma}\textbf{Relation between $\cs(\Gamma)$ and $\cs(V)$}\\
$\forall s \in \cs(\Gamma), \forall u \in V, \varphi(s)[u] = s[\varphi^{-1}(u)] = s[g_u]$
\label{lem:outer}
\end{lemma}

\begin{proof}
\begin{align*}
\forall s \in \cs(\Gamma), \varphi(s) & = \varphi(\displaystyle \sum_{g \in \Gamma} s[g] \h{2} \delta_g)
 = \displaystyle \sum_{g \in \Gamma} s[g] \h{2} \varphi(\delta_g)
 = \displaystyle \sum_{g \in \Gamma} s[g] \h{2} \delta_{\varphi(g)}\\
 & = \displaystyle \sum_{v \in V} s[g_v] \h{2} \delta_v\\
 \text{So }\forall v \in V, \varphi(s) [u] & = s[g_u]
\end{align*}
\end{proof}

Hence, we can steer the definition of the group convolution from $\cs(\Gamma)$ to $\cs(V)$ as follows:

\begin{definition}\textbf{Group convolution II}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$.
The group convolution II between two signals $s_1$ and $s_2 \in \cs(V)$ is defined as:
\begin{align*}
\forall u \in V, (s_1 \ast_{\II} s_2) [u] & = \displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[\varphi(g_v^{-1}g_u)]\\
& = \displaystyle \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_u }} s_1[a] \h{2} s_2[b]
\end{align*}
\label{def:conv2}
\end{definition}

\begin{lemma}\textbf{Relation between group convolution I and II}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$,
\begin{gather*}
\forall s_1, s_2 \in \cs(\Gamma), \forall u \in V,
(\varphi(s_1) \ast_{\II} \varphi(s_2))[u] = (s_1 \ast_{\I} s_2)[g_u]
\end{gather*}
\label{lem:rel12}
\end{lemma}

\begin{proof}
Using \lemref{lem:outer},
\begin{align*}
(\varphi(s_1) \ast_{\II} \varphi(s_2))[u] & = \displaystyle \sum_{v \in V} \varphi(s_1)[v] \h{2} \varphi(s_2)[\varphi(g_v^{-1}g_u)]\\
 & = \displaystyle \sum_{v \in V} s_1[g_v] \h{2} s_2[g_v^{-1}g_u]\\
 & = \displaystyle \sum_{g \in \Gamma} s_1[g] \h{2} s_2[g^{-1}g_u]\\
 & = (s_1 \ast_{\I} s_2)[g_u]
\end{align*}
\end{proof}

\begin{proposition}\textbf{Equivariance to $\varphi(\Gamma)$}\\
With \defref{def:conv2}, convolution operators acting on the right of $\cs(V)$ are equivariant to $\varphi(\Gamma)$ \ie
\begin{gather*}
\exists w \in \cs(V), f = . \ast_{\II} w \Rightarrow \forall v \in V, f \circ \varphi(g_v) = \varphi(g_v) \circ f
\end{gather*}
\label{prop:equiV}
\end{proposition}

\begin{proof}
\begin{align*}
\forall s \in \cs(V), \forall u \in V & ,\forall v \in V,\\
(f_w \circ \varphi(g_u)) (s) [v] & = \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_v }} \varphi(g_u)(s)[a] \h{2} w[b]\\
& = \sum_{\substack{(a,b) \in V^2 \\ \st g_ag_b=g_v }} s[\varphi(g_u)^{-1}(a)] \h{2} w[b]\\
& = \sum_{\substack{(a,b) \in V^2 \\ \st g_{\varphi(g_u)(a)}g_b=g_v }} s[a] \h{2} w[b]\\
\end{align*}
Because $\varphi$ is an isomorphism, its inverse $c \mapsto g_c$ is also an isomorphism and so $g_{\varphi(g_u)(a)}g_b=g_v \Leftrightarrow g_{a}g_b=g_{\varphi(g_u)^{-1}(v)}$. So we have:
\begin{align*}
(f_w \circ \varphi(g_u)) (s) [v] & = \sum_{\substack{(a,b) \in V^2 \\ \st g_{a}g_b=g_{\varphi(g_u)^{-1}(v)} }} s[a] \h{2} w[b]\\
& = s \ast_{\II} w [\varphi(g_u)^{-1}(v)]\\
& = (\varphi(g_u) \circ f_w) (s) [v]
\end{align*}
\end{proof}

\begin{remark}Note that convolution operators of the form $f_w = . \ast_{\I} w$ are also equivariant to $\group$, but the proposition and the proof are omitted as they are similar to the latter.
\end{remark}

In fact, both group convolutions are the same as the latter one borrows the algebraic structure of the first one. Thus we only obtain equivariance to $\varphi(\Gamma)$, which is actually $V$ equipped with the group structure of $\Gamma$ mirrored via $\varphi$. To obtain equivariance to $\Gamma$, we need to take into account the fact that it contains bijective transformations of $V$.

Hence, note that $g \in \Gamma$ can act on both $\Gamma$ through the left multiplication and on $V$ as being an object of $\Phi^{*}(V)$. This ambivalence can be seen on a commutative diagram, see \figref{fig:com}.%, where all arrows except the one labeled with \eqref{eq:P} are always true.

\begin{figure}[H]
\centering
\begin{tikzcd}
    g_u \arrow{r}{g_v}  \arrow{d}[swap]{\varphi}  & g_vg_u \arrow{d}{\varphi}\\  
    u \arrow{r}{\eqref{eq:P}}[swap]{g_v}  & \varphi(g_vg_u)
\end{tikzcd}
\caption{Commutative diagram. All arrows except for the one labeled with \eqref{eq:P} are always True.}
\label{fig:com}
\end{figure}

For \eqref{eq:P} to be true means that $\varphi$ is an equivariant map between groups \ie whether the mapping is done before or after the action of $\Gamma$ has no impact on the result. When such $\varphi$ exists, $\Gamma$ and $V$ are said to be equivalent (in the isomorphic sense) and we denote $\Gamma \equiv V$.

\begin{definition}\textbf{Equivariant map}\\
An isomorphism $\varphi$ between a group of permutations $\cg$ and a group $\ch$ is said to be an \emph{equivariant map} if
\begin{gather*}
\forall g, h \in \cg, g(\varphi(h)) = \varphi(gh)
\end{gather*}
\end{definition}

In our case we have $\Gamma \overset{\varphi}{\cong} V$. If we also have that $\Gamma \equiv V$, we are interested to know if then~$\varphi$~exhibits the equivalence.

\begin{definition}\textbf{$\varphi$-Equivalence}\\
A subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$, is said to be \emph{$\varphi$-equivalent} if $\varphi$ is an equivariant map \ie if it verifies the property:
\begin{gather*}
\forall v, u \in V, g_v(u) = \varphi(g_vg_u) \tag{P}\label{eq:P}
\end{gather*}
\end{definition}

In that case we denote $\Gamma \overset{\varphi}{\equiv} V$.

\begin{remark}
For example, translations on the grid graph, with $\varphi(t_{i,j}) = (i,j)$, are $\varphi$-equivalent as $t_{i,j}(a,b) = \varphi(t_{i,j} \circ t_{a,b})$. However, with $\varphi(t_{i,j}) = (-i,-j)$, they would not be $\varphi$-equivalent.
\end{remark}

\begin{definition}\textbf{Group convolution III}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $\Gamma \overset{\varphi}{\cong} V$.
The group convolution III between two signals $s_1$ and $s_2 \in \cs(V)$ is defined as:
\begin{align}
s_1 \ast_{\III} s_2 & = \displaystyle \sum_{v \in V} s_1[v] \h{2} g_v(s_2)\label{eq:vdom}\\
& = \displaystyle \sum_{g \in \Gamma} s_1[\varphi(g)] \h{2} g(s_2) \label{eq:premix}
\end{align}
\label{def:conv3}
\end{definition}

The two expressions differ on the domain upon which the summation is done. The expression \eqref{eq:vdom} put the emphasis on each vertex and its action, whereas the expression \eqref{eq:premix} emphasizes on each object of $\Gamma$.

\begin{lemma}\textbf{Relation with group convolution II}\\
$\Gamma \overset{\varphi}{\equiv} V \Leftrightarrow \ast_{\II} = \ast_{\III}$
\label{lem:rel23}
\end{lemma}

\begin{proof}
\begin{align}
\forall s_1, s_2 & \in \cs(V),\nonumber\\
& s_1 \ast_{\II} s_2 = s_1 \ast_{\III} s_2 \nonumber\\
& \Leftrightarrow \forall u \in V,
\displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[\varphi(g_v^{-1}g_u)] = \displaystyle \sum_{v \in V} s_1[v] \h{2} s_2[g_v^{-1}(u)] \label{eq:free}
\end{align}
Hence, the direct sense is obtained by applying \eqref{eq:P}. 

For the converse, given $u, v \in V$, we first realize \eqref{eq:free} for $s_1 := \delta_v$, obtaining $s_2[\varphi(g_v^{-1}g_u)] = s_2[g_v^{-1}(u)]$, which we then realize for a real signal $s_2$ having no two equal entries, obtaining $\varphi(g_v^{-1}g_u) = g_v^{-1}(u)$. From the latter we finally obtain \eqref{eq:P} with the one-to-one correspondence $v := v^{-1}$, where $v^{-1} = \varphi(g_v^{-1})$ and using the fact that $\varphi$ and $\varphi^{-1}$ are isomorphisms.
\end{proof}

This time, we obtain equivariance to $\Gamma$ as expected.

\begin{proposition}\textbf{Equivariance to $\Gamma$}\\
If $\Gamma$ is $\varphi$-equivalent, convolution operators acting on the right of $\cs(V)$ are equivariant to $\Gamma$ \ie
\begin{gather*}
\begin{cases}
\Gamma \overset{\varphi}{\equiv} V\\
\exists w \in \cs(V), f = . \ast w
\end{cases}
\Rightarrow \forall g \in \Gamma, f \circ g = g \circ f
\end{gather*}
where $\ast$ denote either $\ast_{\II}$ or $\ast_{\III}$.
\label{prop:equiG}
\end{proposition}

\begin{proof}
In the following equations, \eqref{eq:rel} is obtained from \lemref{lem:rel23}, \eqref{eq:left} is obtained because left multiplication in a group is an isomorphism, and \eqref{eq:pty} is obtained because of \eqref{eq:P}.
\begin{align}
\forall g \in \Gamma, \forall s \in \cs(V), & \nonumber\\
f_w \circ g (s) & = \displaystyle \sum_{h \in \Gamma} g(s)[\varphi(h)] \h{2} h(w)\label{eq:rel}\\
 & = \displaystyle \sum_{h \in \Gamma} g(s)[\varphi(gh)] \h{2} gh(w)\label{eq:left}\\
 & = \displaystyle \sum_{h \in \Gamma} g(s)[g(\varphi(h))] \h{2} gh(w)\label{eq:pty}\\
 & = \displaystyle \sum_{h \in \Gamma} s[\varphi(h)] \h{2} gh(w)\nonumber\\
\forall g \in \Gamma, \forall s \in \cs(V), & \forall u \in V, \nonumber\\
f_w \circ g (s) [u] & = \displaystyle \sum_{h \in \Gamma} s[\varphi(h)] \h{2} h(w)[g^{-1}(u)]\nonumber\\
& = f_w (s) [g^{-1}(u)]\nonumber\\
& = g \circ f_w (s) [u]\nonumber
\end{align}
\end{proof}

\subsection{Mixed domain formulation}

From $\eqref{eq:premix}$, we can define a mixed domain convolution \ie that is defined for $r \in \cs(\Gamma)$ and $s \in \cs(V)$, without the need of expliciting the isomorphisms $\varphi$.

\begin{definition}\textbf{Mixed domain convolution}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $V \cong \Gamma$.
The mixed domain convolution between two signals $r \in \cs(\Gamma)$ and $s \in \cs(V)$ results in a signal $r \ast_{\M} s \in \cs(V)$ and is defined as:
\begin{gather*}
r \ast_{\M} s = \displaystyle \sum_{g \in \Gamma} r[g] \h{2} g(s)
\end{gather*}
\label{def:convm}
\end{definition}

From a practical point of view, this expression of the convolution is the most useful because it relegates $\varphi$ as an underpinning object. Therefore, only $V$ and some of its transformations are enough to define a convolution.

\begin{lemma}\textbf{Relation with group convolution III}\\
$\forall \varphi \in \iso(\Gamma, V), \forall (r,s) \in \cs(\Gamma) \times \cs(V),$\\
\centerline{$r \ast_{\M} s = \varphi(r) \ast_{\III} s$}
\label{lem:rel3m}
\end{lemma}

\begin{proof}
Let $\varphi \in \iso(\Gamma, V),(r,s) \in \cs(\Gamma) \times \cs(V)$,
\begin{align*}
r \ast_{\M} s & = \displaystyle \sum_{g \in \Gamma} r[g] \h{2} g(s)
  = \displaystyle \sum_{v \in V} r[g_v] \h{2} g_v(s)
  \overset{(\diamond)}{=} \displaystyle \sum_{v \in V} \varphi(r)[v] \h{2} g_v(s)\\
& =\varphi(r) \ast_{\III} s
\end{align*}
Where $\overset{(\diamond)}{=}$ comes from \lemref{lem:outer}.
\end{proof}

In other words, $\ast_{\M}$ is a convenient reformulation of $\ast_{\III}$.

\begin{lemma}\textbf{Relation with group convolution I and II}\\
Let $\varphi \in \iso(\Gamma, V),(r,s) \in \cs(\Gamma) \times \cs(V)$, we have both:
\begin{align*}
\Gamma \overset{\varphi}{\equiv} V & \Leftrightarrow \forall v \in V, (r \ast_{\M} s)[v] = (r \ast_{\I} \varphi^{-1}(s))[g_v]\\
& \Leftrightarrow r \ast_{\M} s = \varphi(r) \ast_{\II} s
\end{align*}
\label{lem:rel12m}
\end{lemma}

\begin{proof}
On one hand, \lemref{lem:rel3m} gives $r \ast_{\M} s = \varphi(r) \ast_{\III} s$. On the other hand, \lemref{lem:rel12} gives $\forall v \in V,
(r \ast_{\I} \varphi^{-1}(s))[g_v] = (\varphi(r) \ast_{\II} s)[v]$. Then \lemref{lem:rel23} concludes.
\end{proof}

\begin{remark}
The converse sense is meaningful because it justifies that when the mixed domain convolution is employed, the property $\Gamma \equiv V$ underlies, without the need of expliciting $\varphi$.
\end{remark}

From mixed domain convolution, we can derive operators acting on the left of $\cs(V)$, of the form $s \mapsto w \ast_{\M} s$, parameterized by $w \in \cs(\Gamma)$. These operators would be relevant as layers of neural networks. On the contrary, derived operators acting on the right $r \mapsto r \ast_{\M} w$ wouldn't be useful. However, the equivariance to $\Gamma$ incurring from \lemref{lem:rel3m} and \propref{prop:equiG} only holds for operators acting on the right. So we need to intertwine an abelian condition as follows.

\begin{proposition}\textbf{Equivariance to $\Gamma$ through left action}\\
Let a subgroup $\Gamma \subset \Phi^*(V)$ such that $V \cong \Gamma$. $\Gamma$ is abelian, if and only if, mixed domain convolution operators acting on the left of $\cs(V)$ are equivariant to it \ie
\begin{gather*}
\forall g,h \in \Gamma, gh = hg \Leftrightarrow \forall w, g \in \Gamma, w \ast_{\M} g(.) = g \circ (w \ast_{\M} .) 
\end{gather*}
\end{proposition}

\begin{proof}
Let $w, g \in \Gamma$, and define $f_w: s \mapsto w \ast_{\M} s$. In the following expressions, \eqref{eq:aba} and \eqref{eq:abb} are equal if and only if $\Gamma$ is abelian:
\begin{align}
f_w \circ g (s) & = \displaystyle \sum_{h \in \Gamma} w[h] \h{2} hg(s) \label{eq:aba}\\
 & = \displaystyle \sum_{h \in \Gamma} w[h] \h{2} gh(s) \label{eq:abb}\\
 & = \displaystyle \sum_{h \in \Gamma} w[h] \h{2} h(s)[g^{-1}(.)] \nn\\
 & = (w \ast_{\M} s )[g^{-1}(.)] \nn\\
 & = g \circ f_w (s) \nn
\end{align}
\end{proof}

\begin{remark}Note that similarly, $*_{\I}$, $*_{\II}$ and $*_{\III}$ are equivariant to $\Gamma$ through left action, if and only if, $\Gamma$ is abelian.
\end{remark}

Depending on the applications, we will build upon either $*_{\III}$ or upon $*_{\M}$ if the abelian condition can be verified.

\subsection{Current drawbacks}

At this point, there are a two drawbacks we don't adress yet:
\begin{description}[style=multiline]%, labelwidth=1.5cm]
    \item[\namedlabel{itm:d1}{(d1)}] $V$ must be in one-to-one correspondence with $\Gamma$,
    \item[\namedlabel{itm:d2}{(d2)}] the converse of the characterization doesn't hold.
\end{description}

In what follows, we now consider the edge set in our construction and keep these drawbacks in mind.