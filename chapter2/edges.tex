\section{Construction with the edge set}
\label{sec:edges}

\subsection{Introduction}

The constructions from the previous section involve the vertex set $V$ and depend on $\Gamma$, a subgroup of the set of invertible transformations on $V$. Therefore, it looks natural to try to relate the edge set and $\Gamma$.

There are two approaches. Either $\Gamma$ describes an underlying graph structure $\gve$, either $G$ can be used to define a relevant subgroup $\Gamma$ to which the produced convolutive operators will be equivariant. Both approaches will help characterize classes of graphs that can support natural definitions of convolutions.

\todo{introduction to be developped more}

%%
%% Draft
%%

%%% What follows is to be reworded and put in the neural network section !
% However we must keep in mind that the resulting convolution would be meant to breed a class of operators that are equivariant to $\Gamma$. In an application where this property is not relevant, such operators would produce layers that are less expressive than dense counterparts. So it is not always possible to leverage a graph structure coming with a dataset if one cannot build meaningful transformations from it. 

\subsection{Edge-constrained transformations}

In this subsection, we are trying to answser the following question:
\begin{itemize}
	\item What graphs admit a $\varphi$-convolution, or an $\M$-convolution (in the sense that they can be defined), under the condition that $\Gamma$ is generated by a set of edge-constrained transformations ?
\end{itemize}

\begin{definition}\textbf{Edge-constrained transformation}\\
An \emph{edge-constrained} (EC) transformation on a graph $\gve$ is a transformation $f: V \mapsto V$ such that
\begin{gather*}
\forall u,v \in V, f(u) = v \Rightarrow u \overset{E}{\sim} v
\end{gather*}
\end{definition}

We denote $\Phi_{\EC}$ and $\Phi^*_{\EC}$ the sets of EC and invertible EC transformations.

\begin{remark}
Note that $\Phi^*_{\EC}$ is not a group, thus why we are only interested in groups generated by its subsets.
\end{remark}

This leads us to consider Cayley graphs~\citep{cayley1878desiderata,wiki:cayley}.

\begin{definition}\textbf{Cayley graph}\\
Let a group $\Gamma$ and one of its generating set $\cu$. The \emph{Cayley graph} generated by $\cu$, is the digraph $\vgve$ such that $V = \Gamma$ and $E$ is such that:
\begin{gather*}
u \rightarrow v \Leftrightarrow \exists g \in \cu, ga = b
\end{gather*}
Also, if $\Gamma$ is abelian, we call it an \emph{abelian Cayley graph}.
\end{definition}

\begin{remark}
Note that for compatibility with the functional notation that we use, we define Cayley graphs with $ga = b$ instead of $ag = b$.
\end{remark}

\paragraph{Convolution on Cayley graphs}
In the case of Cayley graphs, it is clear that $\Gamma \equiv V$ and $\langle \cu \rangle = \Gamma$ \st $\cu \subset \Phi^*_{\EC}$. So that they admit (EC) $\varphi$-convolutions, and (EC) $\M$-convolutions in the abelian case.

More precisely, we obtain the following characterization:

\begin{proposition}\textbf{Characterization by Cayley subgraph isomorphism}\\
Let a graph $\gve$, then:
\begin{enumerate}
\item $G$ admits an (EC) $\varphi$-convolution if and only if it contains a subgraph isomorph to a Cayley graph
\item $G$ admits an (EC) $\M$-convolution if and only if it contains a subgraph isomorph to an abelian Cayley graph
\end{enumerate}
\end{proposition}

\begin{proof}
We show the result in the non-abelian case as the proof for the abelian case is similar.
\begin{enumerate}
	\item From left to right:\\

	\item From right to left:\\
Let a graph $\gve$. We suppose it contains a subgraph $\vec{G_s} = \langle V_s, E_s \rangle$ that is graph-isomorph to a Cayley graph $\vec{\Gamma} = \langle \Gamma, \ce \rangle$, generated by $\cu$.
Let $\psi$ be a graph ismorphism from $V_S$ to $\Gamma$.
$\forall g \in \cu$, we define its action on $V_s$ as $L_g(u) = w \Leftrightarrow g\psi(u) = \psi(w)$. As $\psi$ is a graph isomorphism, the invertible transformations $L_{\cu} = \{L_g, g \in \cu \}$ are (EC). Then, by induction, whenever the actions $L_g$ and $L_h$ are defined, we define the action of $gh$ as $L_{gh}= L_g \circ L_h$. As $\langle \cu \rangle = \Gamma$, $L_g$ is defined for all $g \in \Gamma$. Moreover, the map $g \mapsto L_g$ is injective because $L_g = L_h \Rightarrow \forall u \in V, L_g(u) = L_h(u) \Rightarrow \forall u \in V, g\psi(u) = h\psi(u) \Rightarrow g = h$, so all the actions are well defined (\ie whenever $L_{gh}$ was already defined via $xy = gh$, it is redefined similarly).

\todo{equivariant map, via identity rooting}

\end{enumerate}

\end{proof}


\todo{below to reword}




% Let's suppose that from a vertex set $V$, we have constructed a convolution of the form $*_{\III}$, with $\Gamma \overset{\varphi}{\equiv} V$. One particular underlying graph structure would be define as the digraph $\vgve$, with $E=\{ (u,v), \exists g \in \Gamma, g(u) = v \}$. However, such graph would just be the complete digraph. To keep the information about the group $\Gamma$ somehow in $E$, without obtaining a complete digraph, we need to at least consider a generating set $\cu$. Hence, it is enough to define the edge set as $E=\{ (u,v), \exists g \in \cu, g(u) = v \}$. Conversely, an edge set $E$ with these hypotheses would then naturally support a graph convolution. This leads us to study the particular class of Cayley graphs~\citep{cayley1878desiderata,wiki:cayley}.

% We now consider the class of Cayley (di)graphs~\citep{cayley1878desiderata,wiki:cayley} because the $\varphi$-equivalence property \eqref{eq:P} naturally holds on them.
% \todo{rewrite and obtain: On a Cayley graph, there is $\varphi$ such that the subgroupoid of transformation that are EC is $\varphi$-equivalent (proof on $\cu$ then extended)}

% \begin{definition}\textbf{Cayley graph}\\
% Let a group $\Gamma$ and one of its generating set $\cu$. The \emph{Cayley graph} generated by $\cu$, is the digraph $\vgve$ such that $\Gamma \overset{\varphi}{\equiv} V$ and $E$ is such that:
% \begin{gather*}
% a \sim b \Leftrightarrow \exists u \in \varphi(\cu) \subset V, g_u(a) = b
% \end{gather*}
% \end{definition}

% Cayley graphs allows to alleviate \ref{itm:d1} by summing onto the generating set~$\cu$ instead of onto~$\Gamma$.%, which also makes the convolution on Cayley graphs edge-constrained.

% \begin{definition}\textbf{Cayley graph convolution}\\
% \begin{align*}
% \forall u \in V, (s_1 \ast_{\C} s_2) [u] & = \displaystyle \sum_{g \in \cu} s_1[g] \h{2} g(s_2)
% \end{align*}
% \end{definition}

% Conversely, let a graph $\gve$ and a $\varphi$-equivalent subgroup $\Gamma \subseteq \Phi^{*}(V)$. Then we can generate a Cayley graphs with a generating set of $\Gamma$, and thus define a Cayley graph convolution. In particular, when transformations of~$\Gamma$ are edge-constrained, that would also be the case for this convolution on $G$, which leads us to study edge-constrained transformations.

\todo{operator and characterization}
\todo{which graph is a Cayley graph ?}

\subsection{Construction on graph groupoids}

% need abelian for path commutation. But can choose to take minimal path related to some choice. Cf bastnet.

\todo{work in progress}

On graphs, we notice that the property \eqref{eq:P} can be realized by transformations acting on edges. However, unless the graph is complete, these actions can't be composed everywhere to form another edge constrained action. The algebraic structure that posesses the same kind of properties than a group except that its composition law is not defined everywhere is called a groupoid. The following definitions clarify our discussion.

\begin{definition}\textbf{Groupoid}\\
A groupoid is a set equiped with a closed partial composition law, a unique identity element, and every unique inverses.
\end{definition}

\begin{remark}We use the convention than left and right inverses must be the same.
\end{remark}

\begin{definition}\textbf{Graph groupoid}\\
The \emph{groupoid} $\cp(G)$ of a graph $\gve$ is the set of its paths equiped with:
\begin{enumerate}
\item two maps $\psi$ and $\varphi$ that respectively map a path to its first and last element,
\item a closed partial composition law $gh$ defined if and only if $\psi(g) = \varphi(h)$, which concatenates $g$ behind $h$ and \sout{removes adjacent duplicate vertices} \textcolor{red}{to rewrite},
\item an inverse operator $\h{0}^{-1}$ which maps a path to its reverse,
\item an identity element $\id$ which is the path of length $0$.
\end{enumerate}
\end{definition}

\begin{remark}Recall from \defref{def:path} that a path can't contain adjacent duplicates.
\end{remark}

\begin{remark}Note that even though the composite path $gh$ has elements of $h$ before those of $g$ we write $gh$ instead of $hg$ because we'll need the left operand to act on the right one through functional notation $g(h)$.
\end{remark}

\begin{definition}\textbf{Graph $k$-groupoid}\\
The \emph{$k$-groupoid} $\cp_k(G)$ of a graph $\gve$, for $k \in \bbn^*$, is the groupoid obtained by restricting $\cp(G)$ to paths of length at most $k$ (the definition domain of its composition law is also further restricted by the length of the resulting paths in $\cp(G)$).
\end{definition}

\begin{definition}\textbf{$k$-Groupoid convolution}\\
Let a graph $\gve$. Let a subgroupoid $\Gamma \subseteq \cp_k(G)$. The $k$-groupoid convolution between two signals $s_1$ and $s_2 \in \cs(\Gamma)$ is defined as:
\begin{align*}
\forall h \in \Gamma, (s_1 \ast s_2) [h] & = \displaystyle \sum_{\substack{(a,b) \in \Gamma^2 \\ \st ab=h }} s_1[a] \h{2} s_2[b] \\
& = \displaystyle \sum_{\substack{g \in \Gamma\\ \st \varphi(g) = \varphi(h)}} s_1[g] \h{2} s_2[g^{-1}h]\\
& = \displaystyle \sum_{\substack{g \in \Gamma\\ \st \psi(g) = \psi(h)}} s_1[hg^{-1}] \h{2} s_2[g]
\end{align*}
\label{def:pconv}
\end{definition}

\begin{claim}\textbf{Path transformation}\\
Let a graph $\gve$. By identifying vertices with paths of length $1$, a path $g \in \cp(G)$ can act as a transformation on $v \in V$ through the composition law of $\cp(G)$. Also note that $g(v) = g(v^{-1})$.
\end{claim}

We can nom define the $k$-Groupoid convolution operator on $\cs(G)$ by restriction of the second operand from $\cs(\Gamma)$ to paths of length $1$:

\begin{definition}\textbf{$k$-Groupoid convolution operator}\\
Let a graph $\gve$. Let a subgroupoid $\Gamma \subseteq \cp_k(G)$. The $k$-groupoid convolution operator $f_w$ with parameter $w \in \cs(\Gamma)$ is defined as:
\begin{gather*}
\forall s \in \cs(\Gamma), \forall h \in \Gamma, f_w(s)[h] = (s \ast w)[h]
\end{gather*}
And when restricted to $\cs(G)$ it is defined as:
\begin{gather*}
\forall s \in \cs(G), \forall v \in V, f_w(s)[v] = \displaystyle \sum_{\substack{g \in \Gamma\\ \st \psi(g) = v}} s[g(v)] \h{2} w[g]\\
\forall s \in \cs(G), \forall v \in V, f_w(s)[v] = \displaystyle \sum_{\substack{g \in \Gamma\\ \st \varphi(g) = v}} s[g] \h{2} w[g^{-1}(v)]
\end{gather*}
\end{definition}

\begin{proposition}\textbf{Groupoid equivariance to $\Gamma$}\\
$k$-Groupoid convolution operators on $\cs(G)$ are groupoid equivariant to $\Gamma$ \ie
\begin{gather*}
\exists w \in \cs(\Gamma), f = w \ast . \Rightarrow
\forall v \in V, \forall g \in \Gamma \st \psi(g^{-1}) = v,
f \circ g [v]= g \circ f [v]
\end{gather*}
\label{prop:equi}
\end{proposition}

\begin{gather}
g(h(v)) maybe false
\end{gather}


Mini patron of todo:
\begin{itemize}
\item Equivariance to $\Gamma$ holds, proof
\item Converse of characterization does not hold yet, except on orbits
\item property for it to hold
\item relaxing one-to-one correspondence constraint but keeping other properties
\item other avenue instead of property: should make use of edges to build a group structure
\item ideal graph (lattice-regular)
\item if group is too much then just groupoid structure from edges is enough
\end{itemize}

\todo{finish this section}

\subsection{To rename}

% \begin{definition}\textbf{Infinite graph}\\
% An \emph{infinite graph} is defined by natural extension of the notion of graph $G=\langle V,E \rangle$ where $V$ and $E$ can be infinite. We denote $\order{G} = \infty$.
% \end{definition}

\begin{definition}\textbf{Graph automorphisms}\\
A graph automorphism of a graph $\gve$ is a bijection in the vertex domain $\phi: V \rightarrow V$ such that $\{u,v\} \in E \Leftrightarrow \{\phi(u), \phi(v)\} \in E$. We denote $\ca(G)$ the group of automorphism on $G$.

We denote by $\ce(\phi)$ the set of input-output mapping of $\phi$, defined as $\ce(\phi) = \{ (x,y) \in V^2, \phi(x) = y \}$.

A graph automorphism $\phi$ is said to be \emph{edge-constrained} (EC) if $\ce(\phi) \subseteq E$. We denote $\ca_{\EC}(G)$ the set of edge-constrained automorphism on $G$.
\end{definition}

\begin{definition}\textbf{Orthogonality}\\
Two graph automorphisms $\phi_1$ and $\phi_2$ are said to be orthogonal, if and only if $\ce(\phi_1) \cap \ce(\phi_2) = \emptyset$, denoted $\phi_1 \bot \phi_2$. They are said to be aligned otherwise.

Similarly, we define orthogonality of $r$ automophisms as $\phi_1 \bot \cdots \bot \phi_r \Leftrightarrow \ce(\phi_1) \cap \cdots \cap \ce(\phi_r) = \emptyset$
\end{definition}


\subsection{Lattice-regular graph}

\begin{definition}\textbf{Lattice-regular graph}\\
A lattice-regular graph is a regular graph that admits $r$ orthogonal edge-constrained automorphisms, where $r$ is its degree.
\end{definition}


%\subsubsection{Grids}{}

%\subsubsection{Lattices}

%\subsubsection{Spatial graphs}

%\subsubsection{Projections of spatial graphs}