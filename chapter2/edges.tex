\section{Inclusion of the edge set in the construction}
\label{sec:edges}

\subsection{Introduction}

The constructions from the previous section involve the vertex set $V$ and depend on $\Gamma$, a subgroup of the set of invertible transformations on $V$. Therefore, it looks natural to try to relate the edge set and $\Gamma$.

There are two approaches. Either $\Gamma$ describes an underlying graph structure $\gve$, either $G$ can be used to define a relevant subgroup $\Gamma$ to which the produced convolutive operators will be equivariant. Both approaches will help characterize classes of graphs that can support natural definitions of convolutions.

\todo{introduction to be developped more}

%%
%% Draft
%%

%%% What follows is to be reworded and put in the neural network section !
% However we must keep in mind that the resulting convolution would be meant to breed a class of operators that are equivariant to $\Gamma$. In an application where this property is not relevant, such operators would produce layers that are less expressive than dense counterparts. So it is not always possible to leverage a graph structure coming with a dataset if one cannot build meaningful transformations from it. 

\subsection{Convolution on Cayley subgraphs}

In this subsection, we are trying to answser the following question:
\begin{itemize}
	\item What graphs admit a $\varphi$-convolution, or an $\M$-convolution (in the sense that they can be defined with the characterization), under the condition that $\Gamma$ is generated by a set of edge-constrained transformations ?
\end{itemize}

\begin{definition}\textbf{Edge-constrained transformation}\\
An \emph{edge-constrained} (EC) transformation on a graph $\gve$ is a transformation $f: V \mapsto V$ such that
\begin{gather*}
\forall u,v \in V, f(u) = v \Rightarrow u \overset{E}{\sim} v
\end{gather*}
\end{definition}

We denote $\Phi_{\EC}(G)$ and $\Phi^*_{\EC}(G)$ the sets of EC and invertible EC transformations. When a convolution is defined as a sum over a set that is in one-to-one correspondence with a group that is generated from a set of (EC) transformations, we call it an (EC) convolution.

\begin{remark}
Note that $\Phi^*_{\EC}(G)$ is not a group, thus why we are interested in groups and their generating sets.
\end{remark}

This leads us to consider Cayley graphs~\citep{cayley1878desiderata,wiki:cayley}.

\begin{definition}\textbf{Cayley graph}\\
Let a group $\Gamma$ and one of its generating set $\cu$. The \emph{Cayley graph} generated by $\cu$, is the digraph $\vgve$ such that $V = \Gamma$ and $E$ is such that:
\begin{gather*}
u \rightarrow v \Leftrightarrow \exists g \in \cu, ga = b
\end{gather*}
Also, if $\Gamma$ is abelian, we call it an \emph{abelian Cayley graph}. We call Cayley subgraph, a subgraph that is isomorph to a Cayley graph.
\end{definition}

\begin{remark}
Note that for compatibility with the functional notation that we use, we define Cayley graphs with $ga = b$ instead of $ag = b$.
\end{remark}

\paragraph{Convolution on Cayley graphs}
In the case of Cayley graphs, it is clear that $\cu \subseteq \Phi^*_{\EC}$ and $\Phi^* \supseteq \langle \cu \rangle \equiv V$. So that they admit (EC) $\varphi$-convolutions, and (EC) $\M$-convolutions in the abelian case.

More precisely, we obtain the following characterization:

\begin{proposition}\textbf{Characterization by Cayley subgraph isomorphism}\\
Let a graph $\gve$, then:
\begin{enumerate}[label=(\roman*)]
\item $G$ admits an (EC) $\varphi$-convolution if and only if it contains a subgraph isomorph to a Cayley graph
\item $G$ admits an (EC) $\M$-convolution if and only if it contains a subgraph isomorph to an abelian Cayley graph
\end{enumerate}
\end{proposition}

\begin{proof}
We show the result only in the non-abelian case as the proof for the abelian case is similar.
\begin{enumerate}
	\item From left to right: as a direct application of the definitions.

	\item From right to left:\\
Let a graph $\gve$. We suppose it contains a subgraph $\vec{G_s} = \langle V_s, E_s \rangle$ that is graph-isomorph to a Cayley graph $\vec{G_c} = \langle V_c, E_c \rangle$, generated by $\cu$. Let $\psi$ be a graph isomorphism from $G_s$ to $G_c$. To obtain the proof, we need to find a group of invertible transformations $\Gamma$ of $V_s$ generated by a set of (EC) transformations, such that $\Gamma \equiv V_s$.

Let's define the group action $L : V_c \times V_s \rightarrow V_s$ inductively as follows:
\begin{enumerate}[label=(\alph*)]
  \item $\forall g \in \cu, L_g(u) = v \Leftrightarrow g\psi(u) = \psi(v)$ \label{enum:a}
  \item Whenever $L_g$ and $L_h$ are defined, the action of $gh$ is defined by homomorphism as $L_{gh}= L_g \circ L_h$ \label{enum:b}
  \item Whenever $L_g$ is defined, the action of $g^{-1}$ is defined by homomorphism as $L_{g^{-1}}=L_g^{-1}$ \ie $L_{g^{-1}}(u) = v \Leftrightarrow \psi(u) = g\psi(v)$ \label{enum:c}
\end{enumerate}

Note that the induction transfers the property \ref{enum:a} to all $g \in V_c$ in a transitive manner because
\begin{gather*}
L_{gh}(u) = L_g(L_h(u)) = w \Leftrightarrow \exists v \in V_s
\begin{cases}
L_h(u) = v\\
L_g(v) = w
\end{cases}
\end{gather*}
and
\begin{gather*}
\exists v \in V_s
\begin{cases}
h\psi(u) = \psi(v)\\
g\psi(v) = \psi(w)
\end{cases}
\Leftrightarrow gh\psi(u) = \psi(w)
\end{gather*}

We must also verify that this construction is well-defined, \ie whenever we define an action with \ref{enum:b} or \ref{enum:c}, if the action was already defined, then they must be equal. This is the case because the homomorphism $g \mapsto L_g$ on $V_c$ is in fact an isomorphism as
\begin{align*}
L_g = L_h & \Leftrightarrow \forall u \in V, L_g(u) = L_h(u)\\
 & \Leftrightarrow \forall u \in V, g\psi(u) = h\psi(u)\\
 & \Leftrightarrow g = h
\end{align*}

Also note that \ref{enum:c} is needed only in case that $V_c$ is infinite.

Denote the set $L_{\cu} = \{L_g, g \in \cu \}$ and $\Gamma = \langle L_{\cu} \rangle \cong V_c$. Let's define the map $\varphi$ as:
\begin{align*}
\Gamma & \rightarrow V_s\\
\varphi: L_g & \mapsto L_g(\psi^{-1}(\id))
\end{align*}
$\varphi$ is bijective because $\forall g \in V_c, \varphi(L_g) = \psi^{-1}(g)$ thanks to \ref{enum:a}.

Additionally, we have:
\begin{align*}
L_h(\varphi(L_g) & = L_h(L_g(\psi^{-1}(\id)))\\
 & = L_h \circ L_g(\psi^{-1}(\id))\\
 & = L_{hg}(\psi^{-1}(\id))\\
 & = \varphi(L_{hg})\\
 & = \varphi(L_h \circ L_g)
\end{align*}
That is, $\varphi$ is a bijective equivariant map and $ \langle L_{\cu} \rangle = \Gamma \overset{\varphi}{\equiv} V_s$. Moreover, $L_{\cu}$ is a set of (EC) transformations thanks to \ref{enum:a}. Therefore, $G$ admits an (EC)~$\varphi$-convolution.
\end{enumerate}
\end{proof}

\begin{corrolary}\textbf{Characterization by $\varphi$}\\
Let a graph $\gve$, and a set $\cu \subset \Phi^*_{\EC}$ \st
\begin{gather*}
\langle \cu \rangle \cong \Gamma \equiv V' \subset V
\end{gather*}
$G$ admits an (EC) $\varphi$-convolution, if and only if, $\varphi$ is a graph isomorphism between the Cayley graph generated by $\cu$ and the subgraph induced by~$V'$.
\label{cor:cayley}
\end{corrolary}

% \begin{proof}
% \todo{or not to do ?}
% \end{proof}

% \paragraph{Locality and weight sharing also hold}
% Let $f_w$ be a $\varphi$-or-$\M$-convolution operator on a Cayley graph (or Cayley subgraph). If the support of $w$ is included in, or equal to $\cu$, then $f_w(s)[v]$ amounts to a dot product between a weight vector $\widetilde{w}$ made of the non-zero entries of $w$ and another one $s_v$ made of entries of $s$ that are located on vertices connected by an edge to $v$. The same weight vector $\widetilde{w}$ is shared for the calculation of every other $f_w(s)[u]$.

\subsection{Preservation of locality and weight sharing}

Let $\vgve$ be a Cayley subgraph, generated by $\cu$, of some graph $G$. Recall that its (EC) $\varphi$-convolution operator is a right operator, and can be expressed as
\begin{align}
\forall s \in \cs(V), \forall u \in V, f_w(s)[u] & = (s \ast_{\varphi} w) [u]\nonumber\\
      & = \displaystyle\sum_{v \in V} s[v] \h{2} w[g_v^{-1}(u)] \label{eq:sum}
\end{align}

From this expression, it is not obvious that $f_w$ is a local operator. To see this, we can show for example the following proposition.

\begin{proposition}\textbf{Locality}\\
When the support of $w$ is a compact (in the sense that its induced subgraph in $G$ is connected), of diameter $d$, the same holds for the support of the sum in \eqref{eq:sum}.
\end{proposition}

\begin{proof}
Without loss of generality subject to growing $\cu$, let's suppose that $w$ has a support $\cm = \varphi(\cn)$, such that $\cn \subset \cu$. $\cn$ and $\cm$ are obviously compacts of diameter $2$. Thanks to \eqref{eq:P}, we have 
\begin{align*}
g_v^{-1}(u) \in \cm & \Leftrightarrow u \in g_v(\cm) = g_v(\varphi(\cn)) = \varphi(g_v\cn)\\
& \Leftrightarrow g_u \in g_v\cn\\
& \Leftrightarrow g_v^{-1} \in \cn g_u^{-1}\\
& \Leftrightarrow g_v \in g_u \cn^{-1}\\
& \Leftrightarrow v \in g_u(\varphi(\cn^{-1}))\\
\end{align*}
where $\cn^{-1}$ reverses the edges of $\cn$. We denote $\ck_u = g_u(\varphi(\cn^{-1}))$

By composing edge reversal and graph isomorphisms (as $\varphi$ and its inverse are, by \propref{cor:cayley}), the compactness and diameter of~$\cn$ is preserved for~$\ck_u$.
\end{proof}

To see that the weights are tied, we can show the following proposition.

\begin{proposition}\textbf{Weight sharing}\\
$\forall a, \alpha \in V, \forall b \in \ck_a, \exists \beta \in \ck_{\alpha}, \quad g_{\beta}^{-1}(\alpha) = g_{b}^{-1}(a)$
\end{proposition}
\begin{proof}
\end{proof}

% Note that locality for k-hop too by G k-hopped or W hop supported

%%%% Draft Below %%%

Hence, we can define a Cayley convolution operator which is fully (EC) in the sense that only ..\todo{}

\begin{definition}\textbf{Cayley convolution operator}\\

\begin{enumerate}[label=(\roman*)]
  \item
    $\begin{aligned}[t]
    \forall s \in \cs(V), \forall u \in V, f_w^{\varphi}(s)[u]
      & = \displaystyle\sum_{v \in \ck_u} s[v] \h{2} w[g_v^{-1}(u)]
    \end{aligned}$
  \item $\forall s \in \cs(V), f_w^{\M}(s) = \displaystyle\sum_{g \in \cv} w[g] \h{2} g(s)$
\end{enumerate}

\end{definition}

\paragraph{Limitation}

\subsection{Groupoid convolution on graphs}

\todo{}
