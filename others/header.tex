\usepackage[utf8]{inputenc}
\usepackage[french, english]{babel}
\usepackage[T1]{fontenc}
\usepackage{lipsum}
%\usepackage{garamondx}
\usepackage[perpage]{footmisc}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{pifont}
\usepackage[mathscr]{euscript}
\usepackage{stmaryrd}
\usepackage[normalem]{ulem}
\usepackage{tikz,tikz-3dplot}
\usepackage{tikz-cd}
\usepackage{pgfplots}
\usepackage{graphicx}
\usepackage{color}
\usepackage{enumitem}
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows}
% \usetikzlibrary{external}
% \tikzexternalize[prefix=tikzext/]
% \tikzset{external/mode=graphics if exists}
\usepackage{framed}
\usepackage{arydshln}
\usepackage{multirow}
\usepackage{mathtools}
%\usepackage{float}
%\usepackage{yhmath}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\wideparen}{\mathord}{yhlargesymbols}{"F3}
\usepackage{floatrow}
\usepackage{pdfpages}
\usepackage{minitoc}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\setcounter{minitocdepth}{2}
%\renewcommand{\mtctitle}{~} % Empty minitoc titles
\usepackage[nobottomtitles]{titlesec}
\usepackage{etoolbox}
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother

%\usepackage{quotchap}
\usepackage{csquotes}

% % Abstract
% \newcommand\abstractname{Abstract}  %%% here
% \makeatletter
% \if@titlepage
%   \newenvironment{abstract}{%
%       \titlepage
%       \null\vfil
%       \@beginparpenalty\@lowpenalty
%       \begin{center}%
%         \bfseries \abstractname
%         \@endparpenalty\@M
%       \end{center}}%
%      {\par\vfil\null\endtitlepage}
% \else
%   \newenvironment{abstract}{%
%       \if@twocolumn
%         \section*{\abstractname}%
%       \else
%         \small
%         \begin{center}%
%           {\bfseries \abstractname\vspace{-.5em}\vspace{\z@}}%
%         \end{center}%
%         \quotation
%       \fi}
%       {\if@twocolumn\else\endquotation\fi}
% \fi
% \makeatother
% Abstract

\newcommand\abstractname{Abstract}  %%% here
\makeatletter
\newenvironment{abstract}[1][\abstractname]{%
  \small
  \begin{center}%
    {\bfseries #1\vspace{-.5em}\vspace{\z@}}%
  \end{center}%
  \quotation}
{\endquotation}
\makeatother


% References
\usepackage{hyperref}
\usepackage{enumitem}
\makeatletter
\def\namedlabel#1#2{\begingroup
    #2%
    \def\@currentlabel{#2}%
    \phantomsection\label{#1}\endgroup
}
\makeatother

% Bibliography
\usepackage[backend=bibtex,
            sorting=nyt, %or ynt?
            style=authoryear,
            natbib=true,
            maxcitenames=2,
            mincitenames=1,
            maxbibnames=99,
            backref=true]
            {biblatex}
\addbibresource{refs/datasets.bib}
\addbibresource{refs/dl_history.bib}
\addbibresource{refs/dl_understanding.bib}
\addbibresource{refs/dl_activations.bib}
\addbibresource{refs/dl_bastnet.bib}
\addbibresource{refs/dl_manifold.bib}
\addbibresource{refs/dl_vertex.bib}
\addbibresource{refs/dl_vertex_old.bib}
\addbibresource{refs/dl_spectral.bib}
\addbibresource{refs/gsp.bib}
\addbibresource{refs/toClassify.bib}
\addbibresource{refs/maths.bib}
\addbibresource{refs/scattering.bib}
\addbibresource{refs/prog_languages.bib}
\addbibresource{refs/online.bib}
\addbibresource{refs/wordvec.bib}

% Style
\setlength\parindent{0pt}
\newcommand{\subsubsubsection}[1]{\paragraph{#1}\mbox{}\\}
\newcommand{\subsubsubsubsection}[1]{\subparagraph{#1}\mbox{}\\}

\usepackage{setspace}
\onehalfspacing % or
%\doublespacing

% numbering lines
\usepackage[left]{lineno}
%linenumbers
%\modulolinenumbers[2]

\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
  \renewenvironment{#1}%
     {\linenomath\csname old#1\endcsname}%
     {\csname oldend#1\endcsname\endlinenomath}}% 
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
  \patchAmsMathEnvironmentForLineno{#1}%
  \patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
\patchBothAmsMathEnvironmentsForLineno{equation}%
\patchBothAmsMathEnvironmentsForLineno{align}%
\patchBothAmsMathEnvironmentsForLineno{flalign}%
\patchBothAmsMathEnvironmentsForLineno{alignat}%
\patchBothAmsMathEnvironmentsForLineno{gather}%
\patchBothAmsMathEnvironmentsForLineno{multline}%
}

% linebreaks in math mode
%\binoppenalty=\maxdimen %700
%\relpenalty=\maxdimen %500

% chapter style
\makeatletter
\def\@makechapterhead#1{%
  %%%%\vspace*{50\p@}% %%% removed!
  \vspace*{0\p@}
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
        \huge\bfseries \@chapapp\space \thechapter
        \par\nobreak
        \vskip 0\p@
    \fi
    \interlinepenalty\@M
    \Huge \bfseries #1\par\nobreak
    \vskip 20\p@
  }}
\def\@makeschapterhead#1{%
  %%%%%\vspace*{50\p@}% %%% removed!
  \vspace*{50\p@}
  {\parindent \z@ \raggedright
    \normalfont
    \interlinepenalty\@M
    \Huge \bfseries  #1\par\nobreak
    \vskip 40\p@
  }}
\makeatother

% Paragraphs
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
                                    {3.25ex \@plus1ex \@minus.2ex}%
                                    {0.01pt}%
                                    {\normalfont\normalsize\bfseries}}
\makeatother

%\setlength{\parskip}{5pt}

% Figures, Table numbering
\usepackage{chngcntr}
\counterwithout{table}{chapter}
\counterwithout{figure}{chapter}

% Theorems
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}%[chapter]
\newtheorem{proposition}[definition]{Proposition}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{corrolary}[definition]{Corrolary}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{claim}[definition]{Claim}

\theoremstyle{remark}
%\newtheorem{remark}[definition]{Remark}
\newtheorem*{remark}{Remark}

\theoremstyle{plain}

\allowdisplaybreaks[1]
\usepackage{etoolbox}% http://ctan.org/pkg/etoolbox
\usepackage{needspace}% http://ctan.org/pkg/needspace
\AtBeginEnvironment{definition}{\Needspace{5\baselineskip}}% \break if fewer than 5\baselineskip is available on page
\AtBeginEnvironment{proposition}{\Needspace{5\baselineskip}}
\AtBeginEnvironment{corrolary}{\Needspace{5\baselineskip}}
\AtBeginEnvironment{lemma}{\Needspace{5\baselineskip}}
\AtBeginEnvironment{claim}{\Needspace{5\baselineskip}}
\AtBeginEnvironment{remark}{\Needspace{5\baselineskip}}

% Annotations
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1\\}}
\newcommand{\etodo}{\emph{\textcolor{red}{todo}}}

% Maths
\usepackage{chngcntr}
\counterwithout{equation}{chapter}

\usepackage{mathbbol}
\newcommand{\bb}{\mathbb{b}}
%\newcommand{\cc}{\mathbb{c}}
\newcommand{\uu}{\mathbb{u}}
\newcommand{\vv}{\mathbb{v}}
\newcommand{\bbe}{\mathbb{E}}
\newcommand{\bbi}{\mathbb{I}}
\newcommand{\bbn}{\mathbb{N}}
\newcommand{\bbr}{\mathbb{R}}
\newcommand{\bbt}{\mathbb{T}}
\newcommand{\bbv}{\mathbb{V}}
\newcommand{\bbu}{\mathbb{U}}
\newcommand{\bbz}{\mathbb{Z}}

\newcommand{\ca}{\mathcal{A}}
\newcommand{\cb}{\mathcal{B}}
\newcommand{\cc}{\mathcal{C}}
\newcommand{\cd}{\mathcal{D}}
\newcommand{\ce}{\mathcal{E}}
\newcommand{\cf}{\mathcal{F}}
\newcommand{\cg}{\mathcal{G}}
\newcommand{\ch}{\mathcal{H}}
\newcommand{\ci}{\mathcal{I}}
\newcommand{\cj}{\mathcal{J}}
\newcommand{\ck}{\mathcal{K}}
\newcommand{\cl}{\mathcal{L}}
\newcommand{\cm}{\mathcal{M}}
\newcommand{\cn}{\mathcal{N}}
\newcommand{\co}{\mathcal{O}}
\newcommand{\cp}{\mathcal{P}}
\newcommand{\cq}{\mathcal{Q}}
\newcommand{\ccr}{\mathcal{R}}
\newcommand{\cs}{\mathcal{S}}
\newcommand{\ct}{\mathcal{T}}
\newcommand{\cu}{\mathcal{U}}
\newcommand{\cv}{\mathcal{V}}
\newcommand{\cW}{\mathcal{W}}
\newcommand{\cx}{\mathcal{X}}
\newcommand{\cy}{\mathcal{Y}}
\newcommand{\cz}{\mathcal{Z}}

\newcommand{\seq}[1]{\{1, 2, \ldots, #1\}}
\newcommand{\sq}[1]{\{1, \ldots, #1\}}
\newcommand{\group}{\mathcal{G}}

\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\off}{off}
\DeclareMathOperator{\order}{order}
\DeclareMathOperator{\tree}{trav}
%\DeclareMathOperator{\deg}{deg}
%\DeclareMathOperator{\dim}{dim}
\DeclareMathOperator{\shape}{shape}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\EC}{\textsc{ec}}
\DeclareMathOperator{\LRF}{\textsc{lrf}}
\DeclareMathOperator{\ER}{\textsc{er}}
\DeclareMathOperator{\OR}{\textsc{or}}
\DeclareMathOperator{\XOR}{\textsc{xor}}
\DeclareMathOperator{\AND}{\textsc{and}}
\DeclareMathOperator{\agg}{\textsc{aggregate}}
%\DeclareMathOperator{\def}{def}
\DeclareMathOperator{\id}{Id}
\DeclareMathOperator{\I}{\textsc{i}}
\DeclareMathOperator{\II}{\textsc{ii}}
\DeclareMathOperator{\III}{\textsc{iii}}
\DeclareMathOperator{\M}{\textsc{m}}
\DeclareMathOperator{\C}{\textsc{c}}
\DeclareMathOperator{\T}{\mathsf{T}}
\DeclareMathOperator{\iso}{\textsc{iso}}
\DeclareMathOperator{\bij}{\textsc{bij}}
\DeclareMathOperator{\D}{\textsc{d}}
\DeclareMathOperator{\AUT}{\textsc{aut}}

\DeclareMathOperator{\scr}{\textsc{R}}
\DeclareMathOperator{\scs}{\textsc{S}}

\DeclareMathOperator{\IN}{\textsc{in}}
\DeclareMathOperator{\OUT}{\textsc{out}}

% Acronyms
\newcommand{\iid}{\emph{i.i.d.}~}
\newcommand{\etal}{\emph{et al.}~}
\newcommand{\ie}{\emph{i.e.}~}
\newcommand{\st}{\emph{s.t.}~}
\newcommand{\eg}{\emph{e.g.}~}
\newcommand{\powth}{\text{$^\text{th}$~}}
\newcommand{\wrt}{\emph{w.r.t.}~}
\newcommand{\nn}{\nonumber}
\newcommand{\cdl}{\cd_{\ltimes}}

% References
\newcommand{\figref}[1]{Figure~\ref{#1}}
\newcommand{\chapref}[1]{Chapter~\ref{#1}}
\newcommand{\appref}[1]{Appendix~\ref{#1}}
\newcommand{\secref}[1]{Section~\ref{#1}}
\newcommand{\algref}[1]{Algorithm~\ref{#1}}
\newcommand{\thref}[1]{Theorem~\ref{#1}}
\newcommand{\propref}[1]{Proposition~\ref{#1}}
\newcommand{\remref}[1]{Remark~\ref{#1}}
\newcommand{\claref}[1]{Claim~\ref{#1}}
\newcommand{\rqref}[1]{Remark~\ref{#1}}
\newcommand{\defref}[1]{Definition~\ref{#1}}
\newcommand{\corref}[1]{Corrolary~\ref{#1}}
\newcommand{\lemref}[1]{Lemma~\ref{#1}}
\newcommand{\conjref}[1]{Conjecture~\ref{#1}}
\newcommand{\probref}[1]{Problem~\ref{#1}}
\newcommand{\quoref}[1]{Quote~\ref{#1}}
\newcommand{\tabref}[1]{Table~\ref{#1}}
%\newcommand{\eqref}[1]{(\ref{#1})} %already defined

\newcommand{\gve}{G = \langle V, E \rangle}
\newcommand{\vgve}{\vec{G} = \langle V, E \rangle}

% hspaces
\newcommand{\h}[1]{\hspace{#1pt}}

% keywords
\newcommand{\keywords}[1]{\textbf{\textit{Index terms---}} #1}

% quotes
\newcommand{\quotes}[1]{``#1''}

% For temptative plans
\newcommand{\fakechapter}[1]{%
  \par\refstepcounter{chapter}% Increase subsection counter
  \chaptermark{#1}% Add subsection mark (header)
  \addcontentsline{toc}{chapter}{\protect\numberline{\thechapter}#1}% Add subsection to ToC
}

\newcommand{\fakesection}[1]{%
  \par\refstepcounter{section}% Increase section counter
  \sectionmark{#1}% Add section mark (header)
  \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}% Add section to ToC
}

\newcommand{\fakesubsection}[1]{%
  \par\refstepcounter{subsection}% Increase section counter
  \subsectionmark{#1}% Add section mark (header)
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}#1}% Add section to ToC
}


%%%
%%% Advanced style
%%%

% \usepackage{color}
% \definecolor{marron}{RGB}{60,30,10}
% \definecolor{darkblue}{RGB}{0,0,80}
% \definecolor{lightblue}{RGB}{80,80,80}
% \definecolor{darkgreen}{RGB}{0,80,0}
% \definecolor{darkgray}{RGB}{0,80,0}
% \definecolor{darkred}{RGB}{80,0,0}
% \definecolor{shadecolor}{rgb}{0.97,0.97,0.97}

\usepackage{wallpaper}
\usepackage{wrapfig,booktabs}

\usepackage{fancyhdr}
\usepackage{lettrine}
\input Acorn.fd
\newcommand*\initfamily{\usefont{U}{Acorn}{xl}{n}}

% \usepackage{geometry}
% \geometry{
% tmargin=5cm, 
% bmargin=5cm, 
% lmargin=5cm, 
% rmargin=3cm,
% headheight=1.5cm,
% headsep=0.8cm,
% footskip=0.5cm}


% \usepackage[full]{textcomp}
\renewcommand{\familydefault}{pplj} 
\usepackage[
final,
stretch=10,
protrusion=true,
tracking=true,
spacing=on,
kerning=on,
expansion=true]{microtype}

% \setlength{\parskip}{1.3ex plus 0.2ex minus 0.2ex}


% \usepackage{fourier-orns}

% \newcommand{\ornamento}{\vspace{2em}\noindent \textcolor{darkgray}{\hrulefill~ \raisebox{-2.5pt}[10pt][10pt]{\leafright \decofourleft \decothreeleft  \aldineright \decotwo \floweroneleft \decoone   \floweroneright \decotwo \aldineleft\decothreeright \decofourright \leafleft} ~  \hrulefill \\ \vspace{2em}}}
% \newcommand{\ornpar}{\noindent \textcolor{darkgray}{ \raisebox{-1.9pt}[10pt][10pt]{\leafright} \hrulefill \raisebox{-1.9pt}[10pt][10pt]{\leafright \decofourleft \decothreeleft  \aldineright \decotwo \floweroneleft \decoone}}}
% \newcommand{\ornimpar}{\textcolor{darkgray}{\raisebox{-1.9pt}[10pt][10pt]{\decoone \floweroneright \decotwo \aldineleft \decothreeright \decofourright \leafleft} \hrulefill \raisebox{-1.9pt}[10pt][10pt]{\leafleft}}}

% \makeatletter
% \def\headrule{{\color{darkgray}\raisebox{-2.1pt}[10pt][10pt]{\leafright} \hrulefill \raisebox{-2.1pt}[10pt][10pt]{~~~\decofourleft \decotwo\decofourright~~~} \hrulefill \raisebox{-2.1pt}[10pt][10pt]{ \leafleft}}}
% \makeatother

% \fancyhf{}

% \renewcommand{\chaptermark}[1]{\markboth{#1}{}}
% \renewcommand{\sectionmark}[1]{\markright{#1}}

% \newcommand{\estcab}[1]{\itshape\textcolor{marron}{\nouppercase #1}}

% \fancyhead[LE]{\estcab{Fran Oldstyle}}
% \fancyhead[RE]{\estcab{History of taxonomy}}
% % \fancyhead[CE,CO]{\estcab{\decoone}}
% \fancyhead[LO]{\estcab{\rightmark}} % malo cuando no hay section ~~~ \thesection
% \fancyhead[RO]{\estcab{\leftmark}}

% % \fancyhead[RO]{\bf\nouppercase{ \leftmark}}
% % \fancyfoot[LE]{\bf \thepage ~~ \leafNE}
% % \fancyfoot[RO]{ \leafNE  ~~ \bf \thepage}

% \fancyfoot[LO]{
% \ornimpar \\ \large \hfill \sffamily\bf \textcolor{darkgray}{\leafNE ~~~ \thepage}
% }
% \fancyfoot[RE]{\ornpar   \\ \large  \sffamily\bf \textcolor{darkgray}{\thepage ~~~ \reflectbox{\leafNE}}  \hfill}

% \newenvironment{Section}[1]
% {\section{\vspace{0ex}#1}}
% {\vspace{12pt}\centering ------- \decofourleft\decofourright ------- \par}



% \setlength{\parindent}{1em} % Sangría española
% \pagestyle{fancy}

% \renewcommand{\footnoterule}{\vspace{-0.5em}\noindent\textcolor{marron}{\decosix \raisebox{2.9pt}{\line(1,0){100}} \lefthand} \vspace{.5em} }
% \usepackage[hang,splitrule]{footmisc}
% \addtolength{\footskip}{0.5cm}
% \setlength{\footnotemargin}{0.3cm}
% \setlength{\footnotesep}{0.4cm} 